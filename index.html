<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>To‑Do List</title>
  <style>
    :root{
      --bg: #0f1221;
      --panel: #171a2b;
      --panel-2: #1e2236;
      --text: #e9ecf1;
      --muted: #9aa4b2;
      --primary: #6ea8fe;
      --accent: #8bd4ff;
      --danger: #ff6b6b;
      --success: #22c55e;
      --ring: rgba(110,168,254,.45);
      --shadow: 0 10px 30px rgba(0,0,0,.35), 0 2px 10px rgba(0,0,0,.25);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 1200px at 80% -10%, rgba(110,168,254,.08), transparent 60%),
                  radial-gradient(1000px 800px at -10% 100%, rgba(139,212,255,.08), transparent 60%),
                  var(--bg);
      color: var(--text);
      display:grid; place-items:center; padding:24px;
    }
    .app{width:min(880px, 100%);}
    .card{
      background: linear-gradient(180deg, var(--panel), var(--panel-2));
      border: 1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    header{
      padding: 28px 24px 18px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    h1{
      margin:0; font-size: clamp(1.2rem, 2.5vw, 1.6rem); font-weight:700; letter-spacing:.4px;
      display:flex; align-items:center; gap:10px;
    }
    h1 .logo{display:inline-flex}
    .logo svg{width:26px;height:26px}

    .controls{display:flex; align-items:center; gap:8px; flex-wrap:wrap}
    .filter{display:flex; gap:6px; background:#0e1120; padding:6px; border-radius:999px; border:1px solid rgba(255,255,255,.06)}
    .filter button{
      border:0; background:transparent; color:var(--muted); padding:8px 12px; border-radius:999px; cursor:pointer; font-weight:600; letter-spacing:.2px;
    }
    .filter button.active{ color:var(--text); background: rgba(255,255,255,.06); }
    .btn{
      border:1px solid rgba(255,255,255,.1); background:#101428; color:var(--text); padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600;
    }
    .btn:hover{ filter: brightness(1.1) }

    .input-row{ display:flex; gap:10px; padding:0 24px 18px; }
    .input-row form{ flex:1; display:flex; gap:10px }
    input[type="text"]{
      flex:1; padding:14px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:#0e1120; color:var(--text);
      outline:none; font-size:16px; transition:border .15s, box-shadow .15s;
    }
    input[type="text"]:focus{ border-color: var(--primary); box-shadow: 0 0 0 4px var(--ring); }
    .add-btn{ padding:14px 16px; border-radius:12px; border:0; background:linear-gradient(180deg, var(--primary), #4c83f5); color:#fff; font-weight:700; cursor:pointer }

    .list{ padding: 10px 8px 6px; }
    ul{ list-style:none; margin:0; padding:0 8px 10px; }
    li{
      background: rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.06);
      border-radius:14px; margin:10px 0; padding:10px 12px; display:grid; grid-template-columns:auto 1fr auto; gap:12px; align-items:center;
    }
    li[draggable="true"]{ cursor:grab }
    li.dragging{ opacity:.6; transform:scale(.98) }
    .check{
      appearance:none; width:22px; height:22px; border-radius:6px; border:2px solid #5b6885; display:grid; place-items:center; background:transparent; cursor:pointer;
    }
    .check:checked{ border-color: var(--success); background:rgba(34,197,94,.15) }
    .check:checked::after{ content:""; width:12px; height:12px; border-radius:3px; background: var(--success) }

    .title{ outline:none; padding:10px 12px; border-radius:10px; }
    .title.completed{ text-decoration: line-through; color: var(--muted) }
    .actions{ display:flex; gap:6px }
    .icon-btn{ background:transparent; border:0; cursor:pointer; padding:8px; border-radius:10px; color:var(--muted) }
    .icon-btn:hover{ background: rgba(255,255,255,.06); color:var(--text) }

    footer{
      border-top:1px solid rgba(255,255,255,.06);
      display:flex; align-items:center; justify-content:space-between; gap:10px; padding:14px 18px 16px; color:var(--muted);
      flex-wrap:wrap
    }
    .count{ font-weight:600 }
    .empty{ color:var(--muted); text-align:center; padding:18px 0 6px }

    @media (max-width:520px){
      .input-row{ flex-direction:column }
      .controls{ width:100%; justify-content:space-between }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="card" aria-labelledby="title">
      <header>
        <h1 id="title">
          <span class="logo" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <rect x="3" y="3" width="18" height="18" rx="4"/>
              <path d="M7 13l3 3 7-7"/>
            </svg>
          </span>
          To‑Do List
        </h1>
        <div class="controls" role="group" aria-label="Filtres">
          <div class="filter" id="filterBtns">
            <button type="button" data-filter="all" class="active">Tout</button>
            <button type="button" data-filter="active">Actives</button>
            <button type="button" data-filter="completed">Terminées</button>
          </div>
          <button class="btn" id="clearCompleted" type="button">Supprimer les terminées</button>
        </div>
      </header>

      <div class="input-row">
        <form id="todoForm" autocomplete="off" aria-label="Ajouter une tâche">
          <input id="todoInput" type="text" placeholder="Que voulez-vous faire ? (Entrée pour ajouter)" aria-label="Nouvelle tâche" />
          <button class="add-btn" type="submit">Ajouter</button>
        </form>
      </div>

      <div class="list">
        <ul id="todoList" role="list" aria-live="polite" aria-relevant="additions removals text"></ul>
        <div class="empty" id="emptyState">Aucune tâche. Ajoutez-en une pour commencer ✨</div>
      </div>

      <footer>
        <div>💡 Astuce : double‑cliquez sur un titre pour l’éditer.</div>
        <div class="count" id="count" aria-live="polite">0 tâche</div>
      </footer>
    </div>
  </div>

  <template id="itemTemplate">
    <li draggable="true">
      <input class="check" type="checkbox" aria-label="Marquer comme terminée" />
      <div class="title" contenteditable="false" spellcheck="false"></div>
      <div class="actions">
        <button class="icon-btn edit" title="Éditer" aria-label="Éditer">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4 12.5-12.5z"/></svg>
        </button>
        <button class="icon-btn delete" title="Supprimer" aria-label="Supprimer">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"/></svg>
        </button>
      </div>
    </li>
  </template>

  <script>
    const STORAGE_KEY = 'todolist.items.v1';
    const listEl = document.getElementById('todoList');
    const emptyEl = document.getElementById('emptyState');
    const countEl = document.getElementById('count');
    const formEl = document.getElementById('todoForm');
    const inputEl = document.getElementById('todoInput');
    const clearBtn = document.getElementById('clearCompleted');
    const filterBtns = document.getElementById('filterBtns');
    const tpl = document.getElementById('itemTemplate');

    let items = loadItems();
    let filter = 'all'; // 'all' | 'active' | 'completed'

    function uid(){ return crypto.randomUUID ? crypto.randomUUID() : Math.random().toString(36).slice(2); }

    function loadItems(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
      catch{ return []; }
    }
    function saveItems(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(items)); }

    function sanitize(text){
      return text.replace(/[\u0000-\u001F\u007F]/g, '').trim();
    }

    function render(){
      listEl.innerHTML = '';
      const frag = document.createDocumentFragment();
      const filtered = items.filter(i => filter==='all' || (filter==='active' ? !i.done : i.done));
      filtered.forEach(item => frag.appendChild(renderItem(item)));
      listEl.appendChild(frag);
      emptyEl.style.display = filtered.length ? 'none' : 'block';
      const activeCount = items.filter(i=>!i.done).length;
      countEl.textContent = `${activeCount} ${activeCount>1?'tâches':'tâche'}`;
    }

    function renderItem(item){
      const node = tpl.content.firstElementChild.cloneNode(true);
      node.dataset.id = item.id;
      const checkbox = node.querySelector('.check');
      const title = node.querySelector('.title');
      const editBtn = node.querySelector('.edit');
      const deleteBtn = node.querySelector('.delete');

      // state
      checkbox.checked = !!item.done;
      title.textContent = item.title;
      title.classList.toggle('completed', !!item.done);

      checkbox.addEventListener('change', () => {
        item.done = checkbox.checked;
        title.classList.toggle('completed', !!item.done);
        saveItems();
        render();
      });

      // editing
      function setEditing(on){
        title.contentEditable = on;
        if(on){
          title.focus();
          document.execCommand && document.execCommand('selectAll', false, null);
        }
      }
      title.addEventListener('dblclick', () => setEditing(true));
      editBtn.addEventListener('click', () => setEditing(title.contentEditable !== 'true'));
      title.addEventListener('keydown', (e)=>{
        if(e.key==='Enter'){
          e.preventDefault(); title.blur();
        } else if(e.key==='Escape'){
          title.textContent = item.title; title.blur();
        }
      });
      title.addEventListener('blur', () => {
        const txt = sanitize(title.textContent || '');
        if(!txt){
          // if emptied, delete
          removeItem(item.id);
          return;
        }
        item.title = txt; saveItems(); render();
      });

      // delete
      deleteBtn.addEventListener('click', () => { removeItem(item.id); });

      // drag & drop
      node.addEventListener('dragstart', (e)=>{
        node.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
        e.dataTransfer.setData('text/plain', item.id);
      });
      node.addEventListener('dragend', ()=> node.classList.remove('dragging'));

      listEl.addEventListener('dragover', (e)=>{
        e.preventDefault();
        const after = getDragAfterElement(listEl, e.clientY);
        const dragging = document.querySelector('.dragging');
        if(!dragging) return;
        if(after == null){ listEl.appendChild(dragging); }
        else{ listEl.insertBefore(dragging, after); }
      });
      listEl.addEventListener('drop', (e)=>{
        e.preventDefault();
        const id = document.querySelector('.dragging')?.dataset.id;
        if(!id) return;
        const newOrder = Array.from(listEl.children).map(li=>li.dataset.id);
        items.sort((a,b)=> newOrder.indexOf(a.id) - newOrder.indexOf(b.id));
        saveItems(); render();
      });

      return node;
    }

    function getDragAfterElement(container, y){
      const els = [...container.querySelectorAll('li:not(.dragging)')];
      return els.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height/2;
        if(offset < 0 && offset > closest.offset){ return { offset, element: child } }
        else return closest;
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    function addItem(title){
      const t = sanitize(title);
      if(!t) return;
      items.push({ id: uid(), title: t, done:false, createdAt: Date.now() });
      saveItems();
      inputEl.value = '';
      render();
    }
    function removeItem(id){
      items = items.filter(i=>i.id!==id);
      saveItems();
      render();
    }

    // events
    formEl.addEventListener('submit', (e)=>{ e.preventDefault(); addItem(inputEl.value); });
    clearBtn.addEventListener('click', ()=>{
      items = items.filter(i=>!i.done); saveItems(); render();
    });
    filterBtns.addEventListener('click', (e)=>{
      const btn = e.target.closest('button[data-filter]'); if(!btn) return;
      filter = btn.dataset.filter; [...filterBtns.children].forEach(b=>b.classList.toggle('active', b===btn)); render();
    });

    // initial data for first-time users
    if(items.length === 0){
      items = [
        { id: uid(), title: '🎯 Réviser un chapitre', done:false, createdAt: Date.now() },
        { id: uid(), title: '🧹 Ranger le bureau', done:true, createdAt: Date.now() },
        { id: uid(), title: '📝 Écrire 3 objectifs', done:false, createdAt: Date.now() }
      ];
      saveItems();
    }

    render();
  </script>
</body>
</html>
